## ИДЗ 2 ОС Дергилёв Марк БПИ 236 Вариант 36

### Условие задачи

«Камень, ножницы, бумага» 2 — олимпийская система.
N cтудентов, изнывающих от скуки на лекции по операционным
системам решили организовать турнир в игру «Камень, ножницы,
бумага» по олимпийской системе (с выбыванием). В случае ничей
(выпадение одинаковых предметов) игра продолжается до победы
одного из участников.
Требуется создать многопроцессное приложение, моделирующее турнир.
Каждый студент — отдельный процесс. Генерация камня, ножниц и бумаги в каждом процессе формируется случайно.


## Описание архитектуры решения:
Используются неименованные семафоры для синхронизации процессов.

Файл: `main_sem_unnamed.cpp`

Кол-во игроков в турнире генерируется случайно в диапазоне от 2 до 100. 

У нас есть две сущности: основная программа и процессы-игроки.

Турнир организован по олимпийской системе, количество раундов = $ log_2 N $ с округлением вверх, где N - количество игроков в турнире. Игрок без соперника сразу проходит в следующий раунд. Обращение к глобальной памяти происходит с блокировкой семафора (в данном случае мьютекса) для обеспечения отсутствия гонок данных.

<b>Логика работы главной программы:</b>
- Главная программа создает и инициализирует разделяемую память с состоянием турнира.
- Главная программа создает следующие семафоры:
    - Главный (мьютекс) для обращения к разделяемой памяти
    - Семафор для получения сообщения от игроков, что выбор сделан
    - Семафор для того, чтобы понять, что раунд закончился 
    - Личные семафоры для каждого игрока (потребуются для того чтобы затриггерить ход игрока из главной программы)
- Запускает N процессов игроков и сохраняет их PID для обработки завершения
- Запускает цикл для раундов
  - генерируются пары
  - игрок без пары проходит в след этап
  - для каждой пары в цикле ждем пока игроки походят и определится победитель. Если ничья, то цикл продолжается.
  - после определения победителя обновляю состояние турнира
  - если остался 1 игрок - завершается турнир
- Освобождает ресурсы



<b>Логика работы процесса игрока:</b>
- ждет пока главный процесс разблокирует семафор игрока
- проверяет не кончился ли турнир и при положительном результате - завершается
- проверяет находится ли он в игре обращением к разделяемой памяти - если нет, то завершается
- делает ход и кладет его в разделяемую память в свою ячейку для ходов
- делает sem_post для семафора готовности раунда, обрабатываемого в основной программе


При завершении программы самостоятельно или по сигналу SIGINT происходит очистка всех ресурсов: закрытие семафоров и дальнейший unlink, закрытие shared memory

#### Пример логов программы:
```
Количество игроков в турнире: 30

Раунд 1
Матч между 1 и 2
  Игрок 2 победил
Матч между 3 и 4
  Игрок 3 победил
Матч между 5 и 6
  Ничья, матч переигрывается... 
  Игрок 5 победил
Матч между 7 и 8
  Ничья, матч переигрывается... 
  Игрок 8 победил
Матч между 9 и 10
  Игрок 10 победил
Матч между 11 и 12
  Ничья, матч переигрывается... 
  Игрок 12 победил
Матч между 13 и 14
  Игрок 14 победил
Матч между 15 и 16
  Игрок 15 победил
Матч между 17 и 18
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Игрок 17 победил
Матч между 19 и 20
  Игрок 20 победил
Матч между 21 и 22
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Игрок 22 победил
Матч между 23 и 24
  Игрок 23 победил
Матч между 25 и 26
  Игрок 25 победил
Матч между 27 и 28
  Игрок 27 победил
Матч между 29 и 30
  Ничья, матч переигрывается... 
  Игрок 29 победил

Раунд 2
Студент 29 проходит в следующий раунд
Матч между 2 и 3
  Игрок 3 победил
Матч между 5 и 8
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Игрок 5 победил
Матч между 10 и 12
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Игрок 12 победил
Матч между 14 и 15
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Игрок 14 победил
Матч между 17 и 20
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Игрок 17 победил
Матч между 22 и 23
  Игрок 22 победил
Матч между 25 и 27
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Ничья, матч переигрывается... 
  Игрок 27 победил

Раунд 3
Матч между 29 и 3
  Игрок 29 победил
Матч между 5 и 12
  Игрок 12 победил
Матч между 14 и 17
  Ничья, матч переигрывается... 
  Игрок 17 победил
Матч между 22 и 27
  Игрок 27 победил

Раунд 4
Матч между 29 и 12
  Игрок 29 победил
Матч между 17 и 27
  Игрок 17 победил

Раунд 5
Матч между 29 и 17
  Игрок 17 победил

Турнир закончен, выиграл игрок под номером: 17
```
